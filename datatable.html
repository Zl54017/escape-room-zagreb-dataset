<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escape Room Zagreb - Tablica podataka</title>
    <link rel="stylesheet" href="frontend/style.css">
</head>
<body>
    <div class="datatable-container">
        <div class="datatable-header">
            <h1>Escape Room Zagreb - Podaci</h1>
            <a href="index.html" class="back-link">← Povratak na početnu</a>
        </div>
        
        <div class="filter-section">
            <form id="filter-form" class="filter-form">
                <div class="filter-inputs">
                    <input 
                        type="text" 
                        id="search-input" 
                        placeholder="Unesite tekst za pretragu..." 
                        class="search-input"
                    >
                    <select id="attribute-select" class="attribute-select">
                        <option value="all">Svi atributi</option>
                        <option value="naziv">Naziv</option>
                        <option value="adresa">Adresa</option>
                        <option value="tezina">Težina</option>
                        <option value="trajanje_minute">Trajanje (min)</option>
                        <option value="maks_igraca">Maks igrača</option>
                        <option value="tvrtka">Tvrtka</option>
                        <option value="tematika">Tematika</option>
                    </select>
                    <button type="submit" class="filter-button">Pretraži</button>
                    <button type="button" id="reset-button" class="reset-button">Poništi</button>
                </div>
            </form>
            <div class="download-section">
                <a id="download-json" href="#" class="download-link" download="escape-rooms.json">Preuzmi JSON</a>
                <a id="download-csv" href="#" class="download-link" download="escape-rooms.csv">Preuzmi CSV</a>
                <p id="download-message" style="display: none; color: #dc3545; margin-top: 10px; font-weight: bold;">Morate biti prijavljeni</p>
            </div>
        </div>
        
        <table class="data-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Naziv</th>
                    <th>Adresa</th>
                    <th>Težina</th>
                    <th>Trajanje (min)</th>
                    <th>Maks igrača</th>
                    <th>Tvrtka</th>
                    <th>Tematika</th>
                    <th>Web stranica</th>
                </tr>
            </thead>
            <tbody id="table-body">
                <!-- Podaci će biti učitani JavaScriptom -->
            </tbody>
        </table>
    </div>

    <script src="frontend/main.js"></script>
    <script>
        let isAuthenticated = false;
        
        async function checkAuthStatus() {
            try {
                const response = await fetch('http://localhost:3000/api/v1/auth/status');
                const data = await response.json();
                isAuthenticated = data.response?.authenticated || false;
                
                const downloadMessage = document.getElementById('download-message');
                const downloadJson = document.getElementById('download-json');
                const downloadCsv = document.getElementById('download-csv');
                
                if (!isAuthenticated) {
                    if (downloadMessage) downloadMessage.style.display = 'block';
                    if (downloadJson) {
                        downloadJson.style.pointerEvents = 'none';
                        downloadJson.style.opacity = '0.5';
                        downloadJson.style.cursor = 'not-allowed';
                    }
                    if (downloadCsv) {
                        downloadCsv.style.pointerEvents = 'none';
                        downloadCsv.style.opacity = '0.5';
                        downloadCsv.style.cursor = 'not-allowed';
                    }
                } else {
                    if (downloadMessage) downloadMessage.style.display = 'none';
                    if (downloadJson) {
                        downloadJson.style.pointerEvents = 'auto';
                        downloadJson.style.opacity = '1';
                        downloadJson.style.cursor = 'pointer';
                    }
                    if (downloadCsv) {
                        downloadCsv.style.pointerEvents = 'auto';
                        downloadCsv.style.opacity = '1';
                        downloadCsv.style.cursor = 'pointer';
                    }
                }
            } catch (error) {
                console.error('Error checking auth status:', error);
            }
        }
        
        function setupDownloadHandlers() {
            const downloadJson = document.getElementById('download-json');
            const downloadCsv = document.getElementById('download-csv');
            
            if (downloadJson) {
                downloadJson.addEventListener('click', (e) => {
                    if (!isAuthenticated) {
                        e.preventDefault();
                        e.stopPropagation();
                        return false;
                    }
                });
            }
            
            if (downloadCsv) {
                downloadCsv.addEventListener('click', (e) => {
                    if (!isAuthenticated) {
                        e.preventDefault();
                        e.stopPropagation();
                        return false;
                    }
                });
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            checkAuthStatus();
            setupDownloadHandlers();
            setTimeout(() => {
                checkAuthStatus();
            }, 200);
        });
    </script>
</body>
</html>

